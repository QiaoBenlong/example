/*
 * menu.c
 *
 *  Created on: 2023年3月19日
 *      Author: continuation
 */

#include <msp430.h>
#include "LCD.h"
#include <stdint.h>
#include"menu.h"
#include"measure.h"
#include<math.h>

const unsigned char  bmp1[]={
                             0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0xC0,0x60,
                             0x60,0x30,0x10,0x58,0x08,0xEC,0x0C,0xE4,0xF4,0x46,0x76,0x06,0x32,0xF2,0x92,0xF2,
                             0xF2,0xC2,0x72,0x46,0x06,0x06,0x04,0xA4,0x2C,0x8C,0xC8,0x58,0x90,0xB0,0x20,0x60,
                             0xC0,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
                             0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x60,0x30,0x9C,0x0E,0x37,0x61,0x0D,0x90,0x4A,
                             0x2F,0x34,0x19,0x0A,0x0D,0xC5,0xE6,0xF2,0xF2,0xC1,0x0D,0x39,0xF9,0xF9,0xF1,0xC1,
                             0x11,0x21,0xE1,0xE1,0xC1,0xC1,0xC3,0x82,0x82,0x86,0x05,0x08,0x18,0x12,0x25,0x43,
                             0xC4,0x8C,0x61,0xB3,0x86,0xCC,0x98,0x70,0xC0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,
                             0x00,0x00,0xC0,0xF8,0x1E,0x87,0x81,0x48,0x15,0x8C,0x73,0x18,0x06,0x03,0x01,0x80,
                             0xC0,0xF0,0xF8,0xFE,0xFF,0xFF,0xC7,0x07,0x1F,0x7F,0xFF,0xFC,0xF0,0xE1,0x87,0x1F,
                             0x7F,0xFC,0xF8,0xE3,0xCF,0x9F,0xFF,0xF9,0xF3,0xC3,0x0F,0x3F,0xFE,0xF8,0xE0,0x80,
                             0x00,0x01,0x06,0x0C,0x72,0xC2,0x16,0xAE,0x68,0x33,0x0E,0x78,0xE0,0x00,0x00,0x00,
                             0x00,0xF8,0xFF,0x00,0x96,0xDA,0x92,0x01,0xFC,0x07,0x00,0x00,0x10,0x7C,0xFE,0xFF,
                             0xFF,0xF7,0xC1,0x03,0x0F,0x3F,0xFF,0xFF,0xFC,0xF0,0xC1,0x03,0x0F,0x8F,0xE3,0xF0,
                             0xFC,0xFC,0xFC,0xF8,0xF9,0xF9,0xFB,0xF3,0xF3,0xE7,0xE7,0xE6,0xC8,0xC3,0xC7,0x9F,
                             0x9F,0x9C,0xB0,0x20,0x00,0x01,0xFF,0x00,0x25,0x65,0x63,0x80,0x1F,0xFE,0x00,0x00,
                             0x00,0x07,0xFF,0xC0,0x0E,0x13,0x76,0x60,0x1F,0x78,0x80,0x00,0x00,0x00,0x00,0x03,
                             0x0F,0x3F,0xFF,0xFF,0xFC,0xF8,0x60,0x03,0x8F,0xC3,0xF0,0xFC,0xFE,0xFF,0xFF,0x7F,
                             0xFF,0xFF,0xFB,0xF8,0xF8,0xF1,0xF1,0xF3,0xE3,0xE3,0xE3,0xC7,0xC7,0x8F,0x8F,0x8F,
                             0x0F,0x1F,0x07,0x01,0x00,0xE0,0x3F,0x00,0x25,0x4E,0x2B,0x80,0xFE,0x1F,0x00,0x00,
                             0x00,0x00,0x00,0x07,0x1E,0x70,0xE4,0xBE,0x28,0x86,0x87,0xCE,0xD8,0x30,0x40,0x80,
                             0x00,0x00,0x00,0x03,0x03,0x11,0x18,0x1E,0x3F,0x3F,0x3F,0x7F,0x7F,0x7F,0xFC,0xFC,
                             0xF8,0xF8,0xF9,0xF1,0xF1,0xF1,0xE3,0xE3,0xC3,0xC7,0xC7,0x07,0x0F,0x07,0x01,0x80,
                             0xC0,0x60,0x70,0xCC,0xE3,0x5D,0x1E,0xAC,0xC8,0x7C,0x3C,0x0F,0x01,0x00,0x00,0x00,
                             0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x07,0x0D,0x1B,0x31,0x60,0xC5,0xDE,0x9F,
                             0x0D,0x02,0xE6,0x54,0x08,0x18,0x90,0x90,0xF0,0x20,0x20,0x20,0xE0,0x40,0x40,0x40,
                             0x40,0xC1,0x41,0x21,0x23,0x23,0x63,0xF7,0x97,0x9B,0x28,0xAC,0x54,0x42,0x0B,0xB9,
                             0x9C,0xDC,0x68,0x30,0x19,0x0D,0x06,0x03,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
                             0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
                             0x01,0x03,0x06,0x07,0x04,0x0E,0x0A,0x09,0x1E,0x1C,0x18,0x11,0x18,0x17,0x13,0x10,
                             0x11,0x15,0x10,0x15,0x18,0x19,0x18,0x19,0x08,0x0C,0x0C,0x06,0x06,0x03,0x03,0x01,
                             0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
}; //电子院院徽

//const unsigned char  bmp3[]={
//                             0x00,0xC0,0xE0,0xF0,0xF0,0xE0,0xC0,0x00,0x00,0x03,0x07,0x0F,0x0F,0x07,0x03,0x00};
//显示光标

void display_start()
{

    display_graphic_64x64(1,2,bmp1);//电子院院徽
    display_GB2312_string(1,63,"2023F204");
    display_GB2312_string(3,75,"郑皓");
    display_GB2312_string(5,70,"申梦飞");
    display_GB2312_string(7,70,"倪荣权");
    //display_float(7,78,ret);
    while(P1IN & BIT3);
    __delay_cycles(10000);//延时消抖 所传递参数为cpu周期

}//展示队名和队员信息

//void display_menu(int x_1_4)
//{
//    display_GB2312_string(1,17,"Fre and Duty");
//    display_GB2312_string(3,17,"Vpp and Rms");
//    display_GB2312_string(5,17,"Waveform graph");
//    display_GB2312_string(7,17,"Spectrum diagr");
//
//    int i;
//    char a=~0;
//    for(i=1;i<=8;i++)
//    {
//        display_graphic_1x8(i,15,&a);
//        display_graphic_1x8(i,14,&a);
//        display_graphic_1x8(i,13,&a);
//    }
//
//    int x=2*x_1_4-1;
//    display_graphic_8x16(x,3,bmp3);
//}

void display_show_Freq(double fre)
{
    display_GB2312_string(3,40,"Freq:");
//    fre=fre-fre*3.7/1000.0;//线性修正算法
//    display_float_xxxxx_xx(5,25,fre*99/100);
    display_float(5,40,fre*99/100/1000);
    display_GB2312_string(5,80,"kHz");
    _delay_cycles(5000000);
}//展示频率

void display_show_Duty(double duty_cycle)
{
    display_GB2312_string(3,50,"Duty:");
    display_float(5,45,duty_cycle*100.0);
    display_GB2312_string(5,100,"%");
    _delay_cycles(5000000);
}//展示占空比

void display_show_Vpp(int16_t* adcbuff)
{
   float vpp=get_vpp(adcbuff,128);
   display_GB2312_string(3,20,"VPP:");
   display_float(3,55,vpp);
   display_GB2312_string(3,105,"V");
}//展示峰峰值

void display_show_Rms(int16_t* adcbuff)
{
   double Vrms=get_rms_2(adcbuff,128);//get_rms_1(adcbuff,128);
   display_GB2312_string(5,20,"Vrms:");
   display_float(5,55,Vrms);
   display_GB2312_string(5,105,"V");
}//展示峰峰值

void display_show_Vpp_Rms(int16_t* adcbuff)
{
   double Vpp=0,Vrms=0;
   int16_t max=adcbuff[0];
   int16_t min=adcbuff[0];
   int i;
       for(i=0;i<64;i++)
       {
           if(max<adcbuff[i])
               max=adcbuff[i];
           if(min>adcbuff[i])
               min=adcbuff[i];
       }

   Vpp=(max-min)*2.5/1024;
   Vrms=Vpp/2.0/14*10;

//get_vpp_rms(adcbuff,128,&Vpp,&Vrms);
   display_GB2312_string(1,20,"VPP:");
   display_float(3,30,Vpp);
   display_GB2312_string(3,105,"V");
   display_GB2312_string(5,20,"Vrms:");
   display_float(7,30,Vrms);
   display_GB2312_string(7,105,"V");
   __delay_cycles(100000);
}//展示峰峰值


void display_wave_data(char num)
{
//    switch (num)
//        {
//         case 0:
//         {
//             display_GB2312_string(4,0,"显示信号占空比");
//         }
//         break;
//         case 1:
//         {
//             display_GB2312_string(4,0,"显示信号频率");
//         }
//         break;
//         case 2:
//         {
//             display_GB2312_string(4,0,"显示信号峰峰值和有效值");
//         }
//         break;
//         case 3:
//         {
//             display_GB2312_string(4,2,"显示信号波形");
//         }
//         break;
//         case 4:
//         {
//             display_GB2312_string(4,2,"显示信号频谱");
//         }
//         break;
//         default:break;
//        }
}
